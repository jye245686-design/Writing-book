---
description: 代码生成工作流程规则 - 先提问再生成，生成后先自行验证
alwaysApply: true
---
# 代码生成工作流程规则

**执行范围**：后续在回答用户问题与生成代码时，均需按本规则执行。

## 核心原则
在开始生成代码之前，**必须先对不确定的内容和需要补充的内容进行提问**，确认后再开始生成。
## 适用场景
### 1. 不确定的内容
当遇到以下情况时，必须先提问：
- **需求不明确**：用户需求描述不够具体或存在歧义
- **实现方式有多种选择**：有多种技术方案或实现路径
- **配置参数未指定**：需要用户选择配置项或参数值
- **文件路径或名称未确定**：需要确认文件位置或命名规范
- **功能范围不清晰**：不确定要实现哪些功能点
### 2. 需要补充的内容
当遇到以下情况时，必须先提问：
- **缺少关键信息**：缺少必要的参数、配置或依赖信息
- **需要用户选择**：需要在多个选项中选择（如格式、风格、库版本等）
- **需要确认假设**：基于推测的内容需要用户确认
- **需要明确约束**：需要了解业务规则、技术限制或特殊要求
## 工作流程
### 步骤1: 分析需求
仔细分析用户的需求，识别：
- ✅ 明确的部分（可以直接实现）
- ❓ 不确定的部分（需要提问）
- ⚠️ 缺失的部分（需要补充）
### 步骤2: 提问确认
对于不确定和需要补充的内容，**明确提问**：
```
在开始实现之前，我需要确认以下内容：
1. [不确定点1] - 请选择/确认...
2. [不确定点2] - 请选择/确认...
3. [缺失信息1] - 请提供...
```
### 步骤3: 等待确认
**等待用户回答后再开始生成代码**，不要基于假设直接实现。
### 步骤4: 开始生成
确认所有关键信息后，再开始生成代码。
### 步骤5: 生成后先自行验证
代码写入完成后，**必须先自行验证再交付**，不得在未验证的情况下直接结束回复。

#### 自测约定（必须执行）
- **必做**：对本次修改或新增的文件运行 **Linter**（如 `ReadLints`），若有报错须修复直至通过。
- **必做**：若项目可构建（如前端 `npm run build`、后端可启动），在合理范围内执行 **构建或启动** 以确认无语法/导入错误；若失败须排查并修复。
- **必做**：若涉及**外部 API 参数**（如 `max_tokens`、URL、请求体格式等），须查阅官方文档确认取值范围与格式，在代码中用注释标出限制，避免因参数越界导致运行时错误。
- **尽量做**：对本次改动相关的**接口或流程做一次真实请求自测**（例如启动后端后 curl 调用、或在前端实际操作对应按钮）；若自测环境依赖 `.env` 或本地服务无法在本机完成，须在回复中说明需要用户在本机执行的自测步骤。
- **可选**：若存在与改动相关的测试，运行测试并修复失败用例。
- **交付前**：确认无新增 Lint 错误、构建/启动通过（或已说明已知限制），再向用户说明完成情况。
## 示例
### ❌ 错误做法
```
用户：添加一个导出功能
AI：直接生成代码（可能不符合用户期望的格式或位置）
```
### ✅ 正确做法
```
用户：添加一个导出功能
AI：在实现导出功能之前，我需要确认：
1. 导出格式：需要支持哪些格式？（Excel、CSV、PDF等）
2. 导出内容：需要导出哪些数据字段？
3. 导出位置：文件保存到哪个目录？
4. 文件命名：使用什么命名规则？
请确认以上信息，我再开始实现。
```
## 特殊情况
### 可以基于合理假设的情况
以下情况可以基于合理假设直接实现，但需要在代码中添加注释说明：
- **标准实践**：遵循项目已有的代码风格和模式
- **明显意图**：用户意图非常明确，没有歧义
- **默认配置**：使用项目默认配置或行业标准
即使如此，如果存在多种合理选择，仍应提问确认。
## 注意事项
- **不要过度提问**：对于明显和标准的内容，可以直接实现
- **提问要具体**：避免模糊的问题，提供明确的选项
- **一次提问完**：尽量将所有问题集中提问，避免多次打断
- **提供建议**：提问时可以提供推荐选项，帮助用户快速决策
- **流程变更同步文档**：每次有**流程顺序或阶段增减**的修改时，除修改代码外，须同步更新 **产品文档**（`docs/产品文档-AI小说生成流程.md`）与 **接口与状态设计**（`docs/接口与状态设计-AI小说生成.md`），并在两处注明版本与变更说明；必要时可增加简要评价与建议（如新旧流程对比、注意点、后续建议）。
- **建议落实同步文档**：当**采纳并实现**产品文档或接口文档中的「建议」「后续扩展」时，除修改代码外，须在对应文档中**补充已落实内容**（例如：阶段输入/输出说明、接口清单与请求参数、在「评价与建议」或「变更说明」中注明「已落实：……」），保持文档与实现一致。

---

## 新增接口请求与方法的约束（仅针对新增）

**适用范围**：仅针对**新增加**的接口请求和方法，不包含对已有接口/方法的修改。

### 正确标准
- 新增的接口请求和方法必须以**能请求成功**为准：URL、HTTP 方法、参数、请求体等配置正确，在实际环境中可成功发起并得到预期响应。

### 工作流程
1. **先列出再写入**：在编写代码之前，必须先列出本次要新增的接口和方法清单，供用户确认。
2. **清单内容建议包含**：
   - 接口说明（用途或接口名）
   - 请求 URL 或 path
   - HTTP 方法（GET/POST/PUT/DELETE 等）
   - 计划落地的文件与函数/方法名（如 `tool.py` 中的某方法）
3. **等待确认**：用户确认清单无误后，再写入具体实现代码。
4. **不直接写**：不得在未列出、未确认的情况下直接添加新的接口请求或封装方法。

### 示例
```
用户：加一个查询订单详情的接口

AI：在实现前，请先确认以下新增接口清单：
| 说明           | URL/Path        | 方法 | 计划位置/方法名   |
|----------------|-----------------|------|-------------------|
| 查询订单详情   | /api/order/detail | GET  | tool.py / get_order_detail |
请确认以上信息无误后，我再写入具体代码。
```
用户确认后，再生成并写入请求逻辑，并确保能请求成功。
